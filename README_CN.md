# Agent Runner

ä¸€ä¸ªç®€å•é«˜æ•ˆçš„ AI é©±åŠ¨æ™ºèƒ½ä»£ç†æ‰§è¡ŒæœåŠ¡ï¼Œæä¾› Rust API å’Œ HTTP REST æ¥å£ï¼Œå¯é›†æˆåˆ°ä»»ä½•åº”ç”¨ä¸­ã€‚

[![Rust](https://img.shields.io/badge/rust-1.70+-orange.svg)](https://www.rust-lang.org)
[![License](https://img.shields.io/badge/license-MIT-blue.svg)](LICENSE)

## ğŸ¯ é¡¹ç›®ç‰¹ç‚¹

- **ğŸ—ï¸ æœåŠ¡æ¶æ„**: å¯ä½œä¸ºç‹¬ç«‹æœåŠ¡è¿è¡Œï¼Œæä¾›æ ‡å‡†APIæ¥å£
- **ğŸ¤– AIåŸç”Ÿ**: ä»åº•å±‚ä¸ºAIè‡ªä¸»æ€§è€Œæ„å»ºï¼Œæœ€å¤§åŒ–AIèƒ½åŠ›
- **ğŸ”— åŒæ¥å£**: æä¾›Rust APIå’ŒHTTP REST APIä¸¤ç§ä½¿ç”¨æ–¹å¼
- **âš¡ é«˜æ€§èƒ½**: æ”¯æŒå¹¶å‘ä»»åŠ¡æ‰§è¡Œå’Œå®æ—¶ç›‘æ§
- **ğŸ› ï¸ å·¥å…·é›†æˆ**: å®‰å…¨çš„æ–‡ä»¶æ“ä½œã€å‘½ä»¤æ‰§è¡Œç­‰å·¥å…·ç³»ç»Ÿ
- **ğŸ“Š ç›‘æ§å®Œå¤‡**: å†…ç½®æŒ‡æ ‡æ”¶é›†å’Œå¥åº·æ£€æŸ¥
- **ğŸ”’ ä¼ä¸šçº§**: æ”¯æŒè®¤è¯ã€é™æµã€CORSç­‰ä¼ä¸šç‰¹æ€§
- **ğŸ”Œ ç»Ÿä¸€LLMæ¥å£**: ä½¿ç”¨ [llm-connector](https://github.com/lipish/llm-connector) æ”¯æŒå¤šä¸ªAIæä¾›å•†
- **âœ¨ æ¨¡å—åŒ–è®¾è®¡**: èŒè´£åˆ†ç¦»çš„æ¶æ„ï¼Œä»£ç æ¸…æ™°æ˜“ç»´æŠ¤

## ğŸ†• æœ€è¿‘ä¼˜åŒ–

### v0.2.1 æ¶æ„é‡æ„ï¼ˆ2025-10ï¼‰

**æ ¸å¿ƒæ”¹è¿›**ï¼š
- âœ… **é€šç”¨åŒ–è®¾è®¡**: é‡å‘½å `CodeAgent` ä¸º `TaskAgent`ï¼Œæ”¯æŒæ›´å¹¿æ³›çš„ä»»åŠ¡ç±»å‹ï¼ˆä¸ä»…é™äºä»£ç ï¼‰
- âœ… **æ¨¡å—åŒ–é‡æ„**: å°†ä»»åŠ¡ç†è§£é€»è¾‘ä» `agent.rs` åˆ†ç¦»åˆ°ç‹¬ç«‹çš„ `understanding.rs` æ¨¡å—
- âœ… **æç¤ºè¯å·¥ç¨‹**: å®ç°çµæ´»çš„æç¤ºè¯æ¨¡æ¿ç³»ç»Ÿï¼Œå‚è€ƒ OpenAI Codex å’Œ Roo-Code
- âœ… **ä»£ç ç²¾ç®€**: `agent.rs` ä» 416 è¡Œå‡å°‘åˆ° 346 è¡Œï¼ˆ-17%ï¼‰
- âœ… **èŒè´£åˆ†ç¦»**: ç†è§£ã€æ‰§è¡Œã€å·¥å…·è°ƒç”¨å„å¸å…¶èŒï¼Œæé«˜å¯ç»´æŠ¤æ€§
- âœ… **å…±äº«æ¨¡å‹**: ä½¿ç”¨ `Arc<dyn LanguageModel>` æ”¯æŒå¤šç»„ä»¶å…±äº« AI æ¨¡å‹
- âœ… **æµ‹è¯•å¢å¼º**: æ–°å¢ 3 ä¸ªå•å…ƒæµ‹è¯•ï¼Œæµ‹è¯•è¦†ç›–ç‡æå‡ 150%
- âœ… **ä»£ç è´¨é‡**: ä¿®å¤æ‰€æœ‰ä¸»è¦ Clippy è­¦å‘Šï¼Œæ”¹è¿›é”™è¯¯å¤„ç†

**æ¶æ„ä¼˜åŠ¿**ï¼š
```rust
// ä¹‹å‰ï¼šæ‰€æœ‰é€»è¾‘æ··åœ¨ä¸€èµ·ï¼Œåç§°å±€é™äºä»£ç 
TaskAgent (416 è¡Œ) - ä»»åŠ¡ç®¡ç† + ç†è§£ + æ‰§è¡Œ + è¾…åŠ©å‡½æ•°

// ä¹‹åï¼šæ¸…æ™°çš„æ¨¡å—åŒ–æ¶æ„ï¼ŒèŒè´£åˆ†ç¦»
agent/                     - Agent æ¨¡å—ï¼ˆ628è¡Œï¼Œ3ä¸ªæ–‡ä»¶ï¼‰
  â”œâ”€â”€ mod.rs              - æ ¸å¿ƒç»“æ„ã€ç”Ÿå‘½å‘¨æœŸç®¡ç†
  â”œâ”€â”€ executor.rs         - ä»»åŠ¡æ‰§è¡Œé€»è¾‘
  â””â”€â”€ planner.rs          - ä»»åŠ¡è§„åˆ’é€»è¾‘

understanding/             - ç†è§£æ¨¡å—ï¼ˆ244è¡Œï¼Œ2ä¸ªæ–‡ä»¶ï¼‰
  â”œâ”€â”€ mod.rs              - æ¨¡å—å…¥å£
  â””â”€â”€ engine.rs           - AI ç†è§£å¼•æ“

execution/                 - æ‰§è¡Œæ¨¡å—ï¼ˆ433è¡Œï¼Œ3ä¸ªæ–‡ä»¶ï¼‰
  â”œâ”€â”€ mod.rs              - æ¨¡å—å…¥å£
  â”œâ”€â”€ file_ops.rs         - æ–‡ä»¶æ“ä½œ
  â””â”€â”€ command_ops.rs      - å‘½ä»¤æ‰§è¡Œ

prompts.rs (300 è¡Œ)        - æç¤ºè¯å·¥ç¨‹ç³»ç»Ÿ
task_helpers.rs (292 è¡Œ)   - ä»»åŠ¡è¾…åŠ©å‡½æ•°
```

**å‘åå…¼å®¹**: ä»¥å‰çš„ `CodeAgent` ç°åœ¨å·²ç»è¢«å®Œå…¨æ›¿æ¢ä¸º `TaskAgent`ã€‚

è¯¦è§ï¼š[é‡æ„æŒ‡å—](doc/REFACTORING_GUIDE.md)

## âœ¨ æç¤ºè¯å·¥ç¨‹ç³»ç»Ÿ

**Agent Runner å®ç°äº†çµæ´»çš„æç¤ºè¯å·¥ç¨‹ç³»ç»Ÿï¼Œçµæ„Ÿæ¥è‡ª OpenAI Codex å’Œ Roo-Codeï¼š

**æ ¸å¿ƒç‰¹æ€§**: åˆ†å±‚ç»“æ„ï¼ˆå…¨å±€+é¡¹ç›®+åœºæ™¯ï¼‰ã€å¤–ç½®YAMLé…ç½®ã€9+é¢„å®šä¹‰åœºæ™¯ã€åŠ¨æ€åŠ è½½ã€æ™ºèƒ½æ¨æ–­ã€å¯æ‰©å±•

**å¿«é€Ÿç¤ºä¾‹**:
```rust
// ä½¿ç”¨é»˜è®¤æ¨¡æ¿
let engine = UnderstandingEngine::new(model);
let plan = engine.understand_task("åˆ›å»ºé…ç½®åŠ è½½å™¨").await?;

// ä½¿ç”¨è‡ªå®šä¹‰æ¨¡æ¿
let template = PromptTemplate::from_file("prompts/rust-project.yaml")?;
let engine = UnderstandingEngine::with_template(model, template);
```

**å†…ç½®åœºæ™¯**: code_generation, refactoring, debugging, testing, documentation, architecture, optimization, file_operations, command_execution

è¯¦è§ï¼š[æç¤ºè¯å·¥ç¨‹æ–‡æ¡£](doc/PROMPT_ENGINEERING.md)

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Rust 1.70+
- é…ç½®çš„AIæ¨¡å‹APIå¯†é’¥ï¼ˆZhipu GLM-4ã€OpenAI GPT-4ç­‰ï¼‰

### æ–¹å¼ä¸€ï¼šå‘½ä»¤è¡Œå·¥å…·

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/lipish/agent-runner.git
cd agent-runner

# é…ç½®APIå¯†é’¥
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œæ·»åŠ ä½ çš„APIå¯†é’¥

# è¿è¡ŒCLI
cargo run -- task "åˆ†æè¿™ä¸ªé¡¹ç›®å¹¶åˆ›å»ºæ‘˜è¦"
```

### æ–¹å¼äºŒï¼šHTTPæœåŠ¡

```bash
# å¯åŠ¨HTTPæœåŠ¡
cargo run --bin agent-runner-server

# åœ¨å¦ä¸€ä¸ªç»ˆç«¯æµ‹è¯•
curl -X POST http://localhost:8080/api/v1/tasks \
  -H "Content-Type: application/json" \
  -d '{"task": "Hello, Agent Runner!"}'
```

## ğŸ“‹ ä½¿ç”¨æ–¹å¼

### 1. Rust API é›†æˆ

```rust
use agent_runner::{
    service::{TaskRunnerService, ServiceConfig, TaskRunnerClient, ApiClientBuilder},
    config::AgentConfig
};
use std::sync::Arc;

#[tokio::main]
async fn main() -> Result<(), Box<dyn std::error::Error>> {
    // åˆ›å»ºæœåŠ¡å®ä¾‹
    let service = Arc::new(TaskRunnerService::new(
        ServiceConfig::default(),
        AgentConfig::load_with_fallback("config.toml")?
    ).await?);

    // åˆ›å»ºå®¢æˆ·ç«¯
    let client = TaskRunnerClient::new(ApiClientBuilder::in_process(service));

    // æ‰§è¡Œä»»åŠ¡
    let response = client.execute_simple_task("åˆ›å»ºä¸€ä¸ªHello Worldç¨‹åº").await?;
    println!("ç»“æœ: {}", response.result.unwrap().summary);

    Ok(())
}
```

### 2. HTTP REST API

```bash
# æ‰§è¡Œä»»åŠ¡
curl -X POST http://localhost:8080/api/v1/tasks \
  -H "Content-Type: application/json" \
  -d '{
    "task": "è¯»å–README.mdæ–‡ä»¶å¹¶æ€»ç»“å†…å®¹",
    "priority": "high"
  }'

# æ‰¹é‡æ‰§è¡Œä»»åŠ¡
curl -X POST http://localhost:8080/api/v1/tasks/batch \
  -H "Content-Type: application/json" \
  -d '{
    "tasks": [
      {"task": "ä»»åŠ¡1"},
      {"task": "ä»»åŠ¡2"}
    ],
    "mode": "parallel"
  }'

# è·å–ä»»åŠ¡çŠ¶æ€
curl http://localhost:8080/api/v1/tasks/{task_id}

# è·å–æœåŠ¡çŠ¶æ€
curl http://localhost:8080/api/v1/status

# è·å–æŒ‡æ ‡
curl http://localhost:8080/api/v1/metrics
```

### 3. è¿œç¨‹é…ç½®ç®¡ç† ğŸ”§

**Code Agent æ”¯æŒé€šè¿‡ API è¿œç¨‹é…ç½®æ¨¡å‹å’Œ API keyï¼Œæ— éœ€é‡å¯æœåŠ¡ï¼**

#### è·å–å½“å‰é…ç½®
```bash
curl http://localhost:8080/api/v1/config
```

#### åŠ¨æ€æ›´æ–°æ¨¡å‹é…ç½®
```bash
curl -X PUT http://localhost:8080/api/v1/config/model \
  -H "Content-Type: application/json" \
  -d '{
    "provider": "zhipu",
    "model_name": "glm-4",
    "api_key": "your-new-api-key",
    "max_tokens": 4000,
    "temperature": 0.7
  }'
```

#### éªŒè¯é…ç½®
```bash
curl -X POST http://localhost:8080/api/v1/config/validate \
  -H "Content-Type: application/json" \
  -d '{
    "config": {
      "model": {
        "provider": "zhipu",
        "model_name": "glm-4",
        "api_key": "test-key"
      }
    }
  }'
```

**é…ç½®ç®¡ç†ç‰¹æ€§:**
- âœ… **åŠ¨æ€é…ç½®**: æ— éœ€é‡å¯æœåŠ¡å³å¯æ›´æ–°æ¨¡å‹å’Œ API key
- âœ… **é…ç½®éªŒè¯**: æäº¤å‰éªŒè¯é…ç½®çš„æ­£ç¡®æ€§
- âœ… **é”™è¯¯å¤„ç†**: è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯å’Œè­¦å‘Šæç¤º
- âœ… **å®‰å…¨æ€§**: API key ç­‰æ•æ„Ÿä¿¡æ¯çš„å®‰å…¨å¤„ç†

### 4. å‘½ä»¤è¡Œå·¥å…·

```bash
# åŸºæœ¬ç”¨æ³•
cargo run -- task "ä½ çš„ä»»åŠ¡æè¿°"

# äº¤äº’æ¨¡å¼
cargo run -- interactive

# è¯¦ç»†è¾“å‡º
cargo run -- task "ä»»åŠ¡" --output verbose

# JSONè¾“å‡º
cargo run -- task "ä»»åŠ¡" --output json
```

## ğŸ”§ é…ç½®

### åŸºæœ¬é…ç½® (config.toml)

```toml
[model]
provider = "zhipu"  # zhipu, openai, anthropic, local
model_name = "glm-4"
api_key = "your-api-key"
max_tokens = 4000
temperature = 0.7

[execution]
max_steps = 10
max_retries = 3
retry_delay_seconds = 1
timeout_seconds = 300

[tools]
enable_file_operations = true
enable_command_execution = true
working_directory = "."
allowed_paths = [".", "./src"]
forbidden_commands = ["rm -rf", "format", "fdisk"]

[service]
max_concurrent_tasks = 10
default_task_timeout = 300
enable_metrics = true
log_level = "info"

[service.cors]
allowed_origins = ["*"]
allowed_methods = ["GET", "POST", "DELETE"]
allowed_headers = ["*"]
allow_credentials = false

[service.rate_limiting]
requests_per_minute = 60
burst_size = 10
```

### ç¯å¢ƒå˜é‡

```bash
# æœåŠ¡é…ç½®
AGENT_RUNNER_MAX_CONCURRENT_TASKS=10
AGENT_RUNNER_DEFAULT_TASK_TIMEOUT=300
AGENT_RUNNER_ENABLE_METRICS=true
AGENT_RUNNER_LOG_LEVEL=info

# æœåŠ¡å™¨é…ç½®
BIND_ADDRESS=0.0.0.0:8080

# AIæ¨¡å‹é…ç½®
AGENT_RUNNER_MODEL_PROVIDER=zhipu
AGENT_RUNNER_MODEL_NAME=glm-4
AGENT_RUNNER_API_KEY=your-api-key

# CORSé…ç½®
AGENT_RUNNER_CORS_ALLOWED_ORIGINS=*
```

## ğŸ“Š API æ–‡æ¡£

### æ ¸å¿ƒ API ç«¯ç‚¹

| ç«¯ç‚¹ | æ–¹æ³• | æè¿° |
|------|------|------|
| `/health` | GET | å¥åº·æ£€æŸ¥ |
| `/api/v1/status` | GET | æœåŠ¡çŠ¶æ€ |
| `/api/v1/metrics` | GET | æœåŠ¡æŒ‡æ ‡ |
| `/api/v1/tools` | GET | å¯ç”¨å·¥å…· |
| `/api/v1/tasks` | POST | æ‰§è¡Œä»»åŠ¡ |
| `/api/v1/tasks/batch` | POST | æ‰¹é‡æ‰§è¡Œ |
| `/api/v1/tasks/{id}` | GET | ä»»åŠ¡çŠ¶æ€ |
| `/api/v1/tasks/{id}` | DELETE | å–æ¶ˆä»»åŠ¡ |
| `/api/v1/config` | GET | è·å–é…ç½® |
| `/api/v1/config` | PUT | æ›´æ–°é…ç½® |
| `/api/v1/config/model` | PUT | æ›´æ–°æ¨¡å‹é…ç½® |
| `/api/v1/config/validate` | POST | éªŒè¯é…ç½® |

### ä»»åŠ¡è¯·æ±‚æ ¼å¼

```json
{
  "task": "ä»»åŠ¡æè¿°",
  "task_id": "å¯é€‰çš„è‡ªå®šä¹‰ID",
  "context": {
    "working_directory": "/path/to/dir",
    "environment": {"VAR": "value"},
    "tools": ["read_file", "write_file"],
    "constraints": {
      "max_execution_time": 300,
      "max_steps": 10,
      "allowed_paths": ["/safe/path"]
    }
  },
  "priority": "low|normal|high|critical",
  "metadata": {"key": "value"}
}
```

### ä»»åŠ¡å“åº”æ ¼å¼

```json
{
  "task_id": "uuid",
  "status": "completed",
  "result": {
    "success": true,
    "summary": "ä»»åŠ¡æ‘˜è¦",
    "details": "è¯¦ç»†ç»“æœ",
    "artifacts": [],
    "execution_time": 30
  },
  "plan": {
    "understanding": "AIå¯¹ä»»åŠ¡çš„ç†è§£",
    "approach": "AIçš„è§£å†³æ–¹æ³•",
    "complexity": "simple|moderate|complex",
    "estimated_steps": 3,
    "requirements": ["tool1", "tool2"]
  },
  "steps": [...],
  "metrics": {...}
}
```

## ğŸ“ˆ ç›‘æ§å’ŒæŒ‡æ ‡

### Prometheus æŒ‡æ ‡

æœåŠ¡åœ¨ `/metrics` ç«¯ç‚¹å¯¼å‡ºPrometheusæŒ‡æ ‡ï¼š

- `ai_agent_requests_total` - APIè¯·æ±‚æ€»æ•°
- `ai_agent_request_duration_seconds` - è¯·æ±‚è€—æ—¶åˆ†å¸ƒ
- `ai_agent_tasks_total` - å¤„ç†ä»»åŠ¡æ€»æ•°
- `ai_agent_tasks_completed_total` - å®Œæˆä»»åŠ¡æ•°
- `ai_agent_tasks_failed_total` - å¤±è´¥ä»»åŠ¡æ•°
- `ai_agent_active_tasks` - å½“å‰æ´»è·ƒä»»åŠ¡æ•°
- `ai_agent_cpu_usage_percent` - CPUä½¿ç”¨ç‡
- `ai_agent_memory_usage_mb` - å†…å­˜ä½¿ç”¨é‡

## ğŸ§ª æµ‹è¯•

### å•å…ƒæµ‹è¯•
```bash
cargo test
```

### é›†æˆæµ‹è¯•
```bash
cd examples
cargo run --example rust_client --features service
cargo run --example http_client --features service
cargo run --example in_process_service --features service
```

### è´Ÿè½½æµ‹è¯•
```bash
# å®‰è£…hey
go install github.com/rakyll/hey@latest

# è´Ÿè½½æµ‹è¯•
hey -n 1000 -c 50 \
  -H "Content-Type: application/json" \
  -d '{"task": "æµ‹è¯•ä»»åŠ¡"}' \
  http://localhost:8080/api/v1/tasks
```

## ğŸ—ï¸ æ¶æ„

### ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Rust Client   â”‚    â”‚  HTTP Client    â”‚    â”‚  Other Clients  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                      â”‚                      â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Agent Runner Service    â”‚
                    â”‚  (Core Business Logic)  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                      â”‚                      â”‚
    â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”
    â”‚  Models   â”‚        â”‚   Tools      â”‚        â”‚  Metrics  â”‚
    â”‚ (Zhipu,   â”‚        â”‚ (File Ops,   â”‚        â”‚(Prometheusâ”‚
    â”‚ OpenAI,   â”‚        â”‚ Commands,    â”‚        â”‚  Export)  â”‚
    â”‚ etc.)     â”‚        â”‚ etc.)        â”‚        â”‚           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒæ¨¡å—æ¶æ„ï¼ˆä¼˜åŒ–åï¼‰

Agent Runner é‡‡ç”¨**æ¨¡å—åŒ–ã€èŒè´£åˆ†ç¦»**çš„æ¶æ„è®¾è®¡ï¼Œç¡®ä¿ä»£ç æ¸…æ™°ã€å¯ç»´æŠ¤ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    agent_runner                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   agent.rs       â”‚â”€â”€â”€â”€â”€â–¶â”‚ understanding.rs     â”‚   â”‚
â”‚  â”‚  (345 è¡Œ)        â”‚      â”‚  (185 è¡Œ)            â”‚   â”‚
â”‚  â”‚                  â”‚      â”‚                      â”‚   â”‚
â”‚  â”‚ â€¢ ä»»åŠ¡ç®¡ç†        â”‚      â”‚ â€¢ æç¤ºè¯æ„å»º          â”‚   â”‚
â”‚  â”‚ â€¢ æ‰§è¡Œåè°ƒ        â”‚      â”‚ â€¢ AI æ¨¡å‹è°ƒç”¨        â”‚   â”‚
â”‚  â”‚ â€¢ å·¥å…·è°ƒç”¨        â”‚      â”‚ â€¢ å“åº”è§£æ           â”‚   â”‚
â”‚  â”‚ â€¢ ç»“æœç”Ÿæˆ        â”‚      â”‚ â€¢ è®¡åˆ’ç”Ÿæˆ           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚         â”‚                                              â”‚
â”‚         â”‚                                              â”‚
â”‚         â–¼                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ execution.rs     â”‚      â”‚     tools.rs         â”‚   â”‚
â”‚  â”‚                  â”‚      â”‚                      â”‚   â”‚
â”‚  â”‚ â€¢ æ‰§è¡Œå¼•æ“        â”‚      â”‚ â€¢ å·¥å…·æ³¨å†Œ           â”‚   â”‚
â”‚  â”‚ â€¢ æ­¥éª¤ç®¡ç†        â”‚      â”‚ â€¢ å·¥å…·æ‰§è¡Œ           â”‚   â”‚
â”‚  â”‚ â€¢ ä¸Šä¸‹æ–‡ç»´æŠ¤      â”‚      â”‚ â€¢ å®‰å…¨æ£€æŸ¥           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ¶æ„ä¼˜åŒ–äº®ç‚¹**ï¼š
- âœ… **èŒè´£åˆ†ç¦»**: ç†è§£é€»è¾‘ä» agent.rs åˆ†ç¦»åˆ°ç‹¬ç«‹çš„ understanding.rs
- âœ… **ä»£ç ç²¾ç®€**: agent.rs ä» 416 è¡Œå‡å°‘åˆ° 345 è¡Œï¼ˆ-17%ï¼‰
- âœ… **å…±äº«æ¨¡å‹**: ä½¿ç”¨ `Arc<dyn LanguageModel>` æ”¯æŒå¤šç»„ä»¶å…±äº«
- âœ… **æ˜“äºæµ‹è¯•**: æ¯ä¸ªæ¨¡å—éƒ½æœ‰ç‹¬ç«‹çš„å•å…ƒæµ‹è¯•
- âœ… **å¯æ‰©å±•æ€§**: æ¸…æ™°çš„æ¨¡å—è¾¹ç•Œä¾¿äºåŠŸèƒ½æ‰©å±•

### ä»»åŠ¡æ‰§è¡Œå·¥ä½œæµ

Agent Runner é‡‡ç”¨**æ¨¡å—åŒ–ã€AI é©±åŠ¨**çš„æ‰§è¡Œæ¨¡å¼ï¼Œé€šè¿‡èŒè´£åˆ†ç¦»å®ç°æ¸…æ™°çš„å¤„ç†æµç¨‹ã€‚

#### å®Œæ•´æ‰§è¡Œæµç¨‹

```
ç”¨æˆ·è¯·æ±‚
   â”‚
   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TaskAgent::process_task()                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”‚
â”‚  â€¢ åˆ›å»ºä»»åŠ¡å®ä¾‹                                              â”‚
â”‚  â€¢ è®¾ç½®ä»»åŠ¡çŠ¶æ€ä¸º InProgress                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é˜¶æ®µ 1: ä»»åŠ¡ç†è§£ (UnderstandingEngine)                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”‚
â”‚  æ¨¡å—: understanding.rs                                      â”‚
â”‚                                                             â”‚
â”‚  1. build_understanding_prompt()                            â”‚
â”‚     â€¢ æ„å»ºç»“æ„åŒ–æç¤ºè¯                                       â”‚
â”‚     â€¢ åŒ…å«ä»»åŠ¡åˆ†æè¦æ±‚                                       â”‚
â”‚                                                             â”‚
â”‚  2. model.complete()                                        â”‚
â”‚     â€¢ è°ƒç”¨ AI æ¨¡å‹åˆ†æä»»åŠ¡                                   â”‚
â”‚     â€¢ è·å– AI å“åº”                                          â”‚
â”‚                                                             â”‚
â”‚  3. parse_task_plan()                                       â”‚
â”‚     â€¢ è§£æ AI å“åº”                                          â”‚
â”‚     â€¢ æå–å…³é”®ä¿¡æ¯ï¼š                                         â”‚
â”‚       - understanding: å¯¹ä»»åŠ¡çš„ç†è§£                          â”‚
â”‚       - approach: è§£å†³æ–¹æ³•                                   â”‚
â”‚       - complexity: å¤æ‚åº¦ (Simple/Moderate/Complex)        â”‚
â”‚       - estimated_steps: é¢„ä¼°æ­¥éª¤æ•°                         â”‚
â”‚       - requirements: ä¾èµ–å’Œè¦æ±‚                            â”‚
â”‚                                                             â”‚
â”‚  è¿”å›: TaskPlan                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é˜¶æ®µ 2: ä»»åŠ¡æ‰§è¡Œ (TaskAgent)                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”‚
â”‚  æ¨¡å—: agent.rs                                              â”‚
â”‚                                                             â”‚
â”‚  execute_task_real()                                        â”‚
â”‚     â€¢ åŸºäº TaskPlan æ‰§è¡Œä»»åŠ¡                                â”‚
â”‚     â€¢ æ¨¡å¼åŒ¹é…è¯†åˆ«ä»»åŠ¡ç±»å‹                                   â”‚
â”‚     â€¢ è°ƒç”¨ç›¸åº”å·¥å…·ï¼š                                         â”‚
â”‚       - read_file: è¯»å–æ–‡ä»¶                                 â”‚
â”‚       - write_file: å†™å…¥æ–‡ä»¶                                â”‚
â”‚       - list_files: åˆ—å‡ºæ–‡ä»¶                                â”‚
â”‚       - run_command: æ‰§è¡Œå‘½ä»¤                               â”‚
â”‚                                                             â”‚
â”‚  è¿”å›: ExecutionResult                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é˜¶æ®µ 3: ç»“æœç”Ÿæˆ                                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€      â”‚
â”‚  â€¢ æ„å»º TaskResult                                          â”‚
â”‚  â€¢ åŒ…å«æ‰§è¡Œæ‘˜è¦ã€è¯¦æƒ…ã€è€—æ—¶                                  â”‚
â”‚  â€¢ æ›´æ–°ä»»åŠ¡çŠ¶æ€ (Completed/Failed)                          â”‚
â”‚  â€¢ è®°å½•æ‰§è¡Œæ—¶é—´                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
                    è¿”å›ç»“æœç»™ç”¨æˆ·
```

#### æ¨¡å—åä½œå…³ç³»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   TaskAgent      â”‚
â”‚   (agent.rs)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 1. è°ƒç”¨ç†è§£å¼•æ“
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ UnderstandingEngine  â”‚
â”‚ (understanding.rs)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 2. è°ƒç”¨ AI æ¨¡å‹
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   LanguageModel      â”‚
â”‚   (models.rs)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 3. è¿”å› TaskPlan
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   TaskAgent      â”‚
â”‚   æ‰§è¡Œä»»åŠ¡        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 4. è°ƒç”¨å·¥å…·
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ToolRegistry       â”‚
â”‚   (tools.rs)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æ ¸å¿ƒç‰¹ç‚¹

- âœ… **èŒè´£åˆ†ç¦»**: ç†è§£ã€æ‰§è¡Œã€å·¥å…·è°ƒç”¨å„å¸å…¶èŒ
- âœ… **AI é©±åŠ¨**: ä½¿ç”¨ AI æ¨¡å‹ç†è§£ä»»åŠ¡æ„å›¾
- âœ… **æ¨¡å—åŒ–è®¾è®¡**: æ¯ä¸ªæ¨¡å—ç‹¬ç«‹å¯æµ‹è¯•
- âœ… **å…±äº«èµ„æº**: é€šè¿‡ Arc å…±äº« AI æ¨¡å‹å®ä¾‹
- âœ… **ç±»å‹å®‰å…¨**: ä½¿ç”¨ Rust ç±»å‹ç³»ç»Ÿä¿è¯æ­£ç¡®æ€§

## ğŸ”’ å®‰å…¨æ€§

### è®¤è¯å’Œæˆæƒ
- APIå¯†é’¥è®¤è¯
- è¯·æ±‚é€Ÿç‡é™åˆ¶
- CORSé…ç½®
- æƒé™æ§åˆ¶

### æ‰§è¡Œå®‰å…¨
- æ²™ç®±æ–‡ä»¶è®¿é—®
- å±é™©å‘½ä»¤è¿‡æ»¤
- è¶…æ—¶ä¿æŠ¤
- èµ„æºé™åˆ¶

## ğŸ¤ è´¡çŒ®

æ¬¢è¿è´¡çŒ®ï¼è¯·æŸ¥çœ‹ [CONTRIBUTING.md](CONTRIBUTING.md) äº†è§£è¯¦æƒ…ã€‚

## ğŸ“š æ–‡æ¡£

- [APIæ–‡æ¡£](doc/SERVICE_API.md) - è¯¦ç»†çš„APIå‚è€ƒ
- [ç³»ç»Ÿè®¾è®¡](doc/system-design.md) - æ¶æ„è®¾è®¡æ–‡æ¡£
- [éƒ¨ç½²æŒ‡å—](doc/DEPLOYMENT.md) - ç”Ÿäº§éƒ¨ç½²æŒ‡å—
- [ç¤ºä¾‹ä»£ç ](examples/README.md) - å®Œæ•´ä½¿ç”¨ç¤ºä¾‹

## ğŸ“„ è®¸å¯è¯

MIT License - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶

## ğŸ”— ç›¸å…³é“¾æ¥

- [GitHubä»“åº“](https://github.com/lipish/agent-runner)
- [Docker Hub](https://hub.docker.com/r/agent-runner/service)
- [APIæ–‡æ¡£](doc/SERVICE_API.md)

---

**Agent Runner** - ç®€å•é«˜æ•ˆçš„ AI é©±åŠ¨æ™ºèƒ½ä»£ç†æ‰§è¡ŒæœåŠ¡ã€‚